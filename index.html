<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Timetable creator - IIT Madras</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

	
	<link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/bootstrap-colorpicker.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">


 <style>
 .tm,.tm2,.structtd{font-size:8pt;width:auto;text-align:center;
    white-space: nowrap; padding:0px !important; } 
    .maintbl td:not(.tm):not(.structtd),.maintbl th:not(.tm2){vertical-align:middle !important; text-align:center; width:18%}
  .table>tfoot>tr>td.tm{padding:0px;}
  th{text-align:center; width:0px;padding:0px;}
  .structtd{width:0%;padding:0px !important; border:0px;}
  td:hover {
background-color: rgba(37, 253, 8, 0.22);
}
.dangerRem{background-color:rgba(255, 0, 0, 0.46);}
.softDanger{background-color:rgba(255, 0, 0, 0.20);}
 </style>
<script type="text/javascript">
	 courses={};
function slotexpand(slotnames){
	slotnames=slotnames.replace(/[\s]/ig,"").toUpperCase().replace("LX","Lx");
	var finalslots=[];
	var slotlist=slotnames.split(/[;,]/ig);
	for (i in slotlist){
		var currslot=slotlist[i];
		switch (currslot){
			case "1":
			case "2":
			case "3":
			case "4":
				finalslots=finalslots.concat([currslot+"A",currslot+"B",currslot+"C"]);
				break;
			case "5":
			case "6":
			case "7":
			case "8":
			case "9":
			case "10":
			case "11":
			case "12":
			case "13":
			case "14":
			case "15":
				finalslots=finalslots.concat([currslot+"A",currslot+"B"]);
				break;				
			default:
				finalslots.push(currslot);
		}
	}
	return finalslots;
}
 function addCourse(coursename,slots,venue,color){
	 console.log(color);
	 eslots=slotexpand(slots);
	 
	 slotid=coursename+"-"+eslots.join("-");
	 slotid="i-"+slotid.replace(/[^A-Za-z0-9\-\_\:\.]/ig,'-');
	courses[slotid]={"name":coursename,"slots":eslots,"venue":venue, "color" : color};
	for(aslot in eslots){
		if($('.slot-'+eslots[aslot]).length<=0){
			alert("Slot "+eslots[aslot]+" does not exist");
			return false;
		}
	}
	
	 for (aslot in eslots){
		 eslots[aslot]=new String(eslots[aslot]);
		if($('.slot-'+eslots[aslot]+'.used').length>0||$('.slot-clash-'+eslots[aslot]+'.used').length>0){
			 var arr=$('.slot-'+eslots[aslot]+'.used,.slot-clash-'+eslots[aslot]+'.used').map(function(){return $(this).find('.slot-name').html()+" ("+$(this).find('.course-name').html()+")"}).get()
			 var arr2=$('.slot-'+eslots[aslot]+'.used,.slot-clash-'+eslots[aslot]+'.used').map(function(){return $(this).find('.course-name').html()}).get()
			$('.course-name').each(function(){if(arr2.indexOf(this.innerHTML)!=-1){$(this).parents(".used").addClass('softDanger')}})
			$('.slot-'+eslots[aslot]+'.used,.slot-clash-'+eslots[aslot]+'.used').addClass('dangerRem').removeClass("softDanger")
			eslots[aslot].nooverwrite=!confirm("Slot clash of "+eslots[aslot]+" with "+arr.join(", ")+", overwrite other course or cancel this one?");
			$('.used').removeClass('dangerRem').removeClass('softDanger')
			if(!eslots[aslot].nooverwrite){
				$('.slot-'+eslots[aslot]+'.used,.slot-clash-'+eslots[aslot]+'.used').each(function(){$('.rmslot[data-slotid='+$(this).data('slotid')+']').click()});
			}else{
				delete courses[slotid];
				return true;
			}
		}
	 }
	 
	 for (aslot in eslots){
		 console.log(eslots[aslot]+" "+eslots[aslot].overwrite)
		if(!eslots[aslot].nooverwrite){
			showSlot(eslots[aslot],true,color);
			var $slot=$('.slot-'+eslots[aslot]);
			$slot.find('.course-name').html(coursename);
			$slot.find('.course-venue').html(venue);
			$slot.data('slotid',slotid)
		}
	 }
	 $('<tr id="list-'+slotid+'"><td><button type="button" class="btn btn-default btn-xs list-'+slotid+' " id="color-button-'+slotid+'"><span class="glyphicon glyphicon-pencil"></span></button></td><td id="list-name-'+slotid+'">'+coursename+'</td><td><button class="rmslot  btn-xs btn btn btn-danger" data-slotid="'+slotid+'">x</button></td></tr>').appendTo('#listb')
	$('#color-button-' + slotid).attr('style', 'background-color:'+color+' !important')
	.colorpicker({format: "rgba", color:color}).on('changeColor', function(ev){
		var rgbc = ev.color.toRGB();
		var rgbc_str = "rgba("+rgbc.r + "," + rgbc.g + "," + rgbc.b + ",0.36)";
		courses[slotid].color = rgbc_str;
		for (aslot in eslots){
			if(!eslots[aslot].nooverwrite){
				$('.slot-'+eslots[aslot]).attr('style', 'background-color:'+rgbc_str+' !important');
			}
		 }
		 updatePerma()
		 $('#color-button-' + slotid).attr('style', 'background-color:'+rgbc_str+' !important');
	});
	 updatePerma()
	 $("#inputrow input:not(#color)").val("");
	 // 	$("#color").val("rgba(255, 255, 0, 0.36)"); // the previous used default color
 }
 

function updatePerma(){
	$('#perma').attr('href','?timetable='+encodeURIComponent(btoa(JSON.stringify(courses)))+"&slots="+$('#snametog').hasClass('active'));
	return $('#perma').attr('href');
}
 function showSlot(slotname,use,color){
	 $('.slot-'+slotname).show();
	 if(use){$('.slot-'+slotname).attr('style', 'background-color:'+color+' !important')
                               .addClass('used');}
	 $('.clashbuddy-'+slotname).show();
	 $('.slot-clash-'+slotname).hide();
 }
 function hideSlot(slotname,unuse){

	 if(unuse){$('.slot-'+slotname).removeClass('used')
			                           .attr('style', 'background-color:white !important');}

	 if($('.clashbuddy-'+slotname+".used").length==0&&$('.clashbuddy-'+slotname).length!=0){
		$('.slot-'+slotname).hide();
		$('.clashbuddy-'+slotname).hide();
		$('.slot-clash-'+slotname).show();	 		 
	 }

 }
 function toggleSlot(){
 $('#snametog').toggleClass('active')
	if($('#snametog').hasClass('active')){
	  $('.slot-name').show();
	  $('#snametog').html('Hide slot names');
	}else{
		$('.slot-name').hide();
		$('#snametog').html('Show slot names');
	};
  $('#snametog').blur();
  updatePerma();
  }
 function getJsonFromUrl() {
	 //From http://stackoverflow.com/a/8486188/1198729, by user Jan Turon
  var query = location.search.substr(1);
  var data = query.split("&");
  var result = {};
  for(var i=0; i<data.length; i++) {
    var item = data[i].split("=");
    result[item[0]] = item[1];
  }
  return result;
}

function printable(){
	history.pushState({},"",updatePerma())
	if(confirm("Remove colors?")){
		$('.used').css('background-color','white')
	}
	$('body').html($('.maintbl').parent().html())
}

function validateICS()
{
	$('#icsForm').html(''); //clean
	$('.maintbl').find('td').each(function(){
	if($(this).hasClass("used"))
	{
		var slot = $(this).find('.slot-name').text();
		var venue = $(this).find('.course-venue').text();
		var course = $(this).find('.course-name').text();
		$('<input type = "hidden" name = "slot[]" value = "'+slot+'" />').appendTo($('#icsForm'));
		$('<input type = "hidden" name = "venue[]" value = "'+venue+'" />').appendTo($('#icsForm'));
		$('<input type = "hidden" name = "course[]" value = "'+course+'" />').appendTo($('#icsForm'));
	}
	});
	$('#icsForm').submit();
}

 </script>
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/bootstrap-colorpicker.min.js"></script>
	<script type="text/javascript" src="js/scripts.js"></script>
</head>

<body>
<script>
$(document).ready(function(){
	$('#listb').on('click','.rmslot',function(){
	var slotid=$(this).data('slotid');
	 slotid=slotid.replace(/\s/ig,'-');
	var slots=courses[slotid].slots;
	for(i in slots){
		//hideSlot(slots[i],true);
		var $slot=$('.slot-'+slots[i]);
		$slot.find('.course-name').html("");
		$slot.find('.course-venue').html("");
		$slot.removeClass('used');
		$slot.attr('style', 'background-color:white !important')
	}
  $('.list-' + slotid).colorpicker('destroy');
	$('#list-'+slotid).remove();
	delete courses[slotid];
	updatePerma();
});
lspl=getJsonFromUrl();
if(lspl["data"]&&lspl["data"].length>0){
	var courses2=JSON.parse(decodeURIComponent(lspl["data"]));
	for(i in courses2){
		if (!courses2[i].color) {
			courses2[i].color = "rgba(255, 255, 0, 0.36)";
		}
		addCourse(courses2[i].name,courses2[i].slots.join(";"),courses2[i].venue,courses2[i].color);
	}

}
if(lspl["timetable"]&&lspl["timetable"].length>0){
	var courses2=JSON.parse(atob(decodeURIComponent(lspl["timetable"])));
	for(i in courses2){
		if (!courses2[i].color) {
			courses2[i].color = "rgba(255, 255, 0, 0.36)";
		}
		addCourse(courses2[i].name,courses2[i].slots.join(";"),courses2[i].venue,courses2[i].color);
	}

}
if(lspl["slots"]&&lspl["slots"]=="false"){

	toggleSlot();
}
	updatePerma();
	
	$('#helpicon').popover({"title":"Separate multiple slots with a comma. <br>Slot groups like '4' also allowed","trigger":"hover","html":true,"placement":"bottom"});
	$('.structtd').html('<br><br>');
  $('.picker').colorpicker({format: "rgba"}).on('changeColor', function(ev){
		var ev_rgb = ev.color.toRGB();
		var alpha = ev_rgb.a
		if (alpha === 1) { alpha = 0.36; }
		var ev_str = "rgba("+ev_rgb.r+","+ev_rgb.g+","+ev_rgb.b+","+alpha+")";
		$("#color").val(ev_str);
	});
	$('.maintbl td').dblclick(function () {
	    var $this = $(this);
	    if($("#cslots").val()==""){
	    	$("#cslots").val($this.find("span").first().text());
	    }
	    else{
	    	var text=$("#cslots").val();
	    	text=text + "," + $this.find("span").first().text();
	    	$("#cslots").val(text);
	    }
	});

});
</script>	


<div class="container">
	<div class = "site-header">
		<div class="row clearfix">
			<div class="col-md-12 column">
				<h3>
					Timetable creator - IIT Madras
				</h3>
			</div>
		</div>
	</div>
	<div class="clearfix">
		<div class="col-md-12 column menu-bar">
				<div class="row clearfix" id="inputrow">
					<div class="col-md-2 column"><input type=text class="form-control" id=ccode placeholder="Course code"/></div>
					<div class="col-md-2 column"><div class="input-group">
						<span class="input-group-addon"><i class="glyphicon glyphicon-question-sign" data-toggle="tooltip"  id="helpicon"></i></span>
						<input type=text class="form-control" id=cslots placeholder="Slots"/>
					</div></div>
					<div class="col-md-2 column"><input type=text class="form-control" id=cvenue placeholder="Venue"/></div>
					<div class="col-md-2 column input-group picker">
						<input type="text" placeholder="BG color" id=color value="rgba(255, 255, 0, 0.36)" class="form-control" />
						<span class="input-group-addon"><i></i></span>
					</div>
					<div class="col-md-1 column"><button class="btn btn-primary" onclick="addCourse($('#ccode').val(),$('#cslots').val(),$('#cvenue').val(), $('#color').val())">Add</button></div>
					<div class="col-md-2 column"><button class="btn btn-default togglebtn active" id=snametog onclick="toggleSlot()">Hide slot names</button></div>
				</div>
			<div class="row">&nbsp;</div> 
		</div>
		<div class="col-md-12 column">
		<div class="row clearfix body-style">
			<div class="col-md-10 column table-style">
				<table class="table table-bordered maintbl">
					<thead>
						<tr>
							<th colspan=3 class=tm2>
								Time
							</th>
							<th>
								Monday
							</th>
							<th>
								Tuesday
							</th>
							<th>
								Wednesday
							</th>
							<th>
								Thursday
							</th>
							<th>
								Friday
							</th>
						</tr>
					</thead>
					<tbody>
					<tr>
						<td class=structtd></td>
						<td colspan=2 class="tm">
							8:00-<br>8:50
						</td>
						<td class="slot-A slot-A1"><span class="slot-name">A1</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-B slot-B2"><span class="slot-name">B2</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-C slot-C3"><span class="slot-name">C3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-E slot-E3"><span class="slot-name">E3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-F slot-F4"><span class="slot-name">F4</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
					</tr>

					<tr>
						<td class=structtd></td>
						<td colspan=2 class="tm">
							9:00-<br>9:50
						</td>
						<td class="slot-B slot-B1"><span class="slot-name">B1</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-C slot-C2"><span class="slot-name">C2</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-D slot-D3"><span class="slot-name">D3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-E slot-F3"><span class="slot-name">F3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-F slot-G4"><span class="slot-name">G4</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
					</tr>

					<tr>
						<td class=structtd></td>
						<td colspan=2 class="tm">
							10:00-<br>10:50
						</td>
						<td class="slot-C slot-C1"><span class="slot-name">C1</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-D slot-D2"><span class="slot-name">D2</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-E slot-E2"><span class="slot-name">E2</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-G slot-G3"><span class="slot-name">G3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-A slot-A4"><span class="slot-name">A4</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
					</tr>

					<tr>
						<td class=structtd></td>
						<td colspan=2 class="tm">
							11:00-<br>11:50
						</td>
						<td class="slot-D slot-D1"><span class="slot-name">D1</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-E slot-E1"><span class="slot-name">E1</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-F slot-F2"><span class="slot-name">F2</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-A slot-A3"><span class="slot-name">A3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-B slot-B4"><span class="slot-name">B4</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
					</tr>

					<tr>
						<td class=structtd></td>
						<td colspan=2 class=tm>11:50-<br>1:00</td>
						<td colspan=42 style="text-align:center">Lunch</td>
					</tr>
					
					<tr>
						<td class=structtd></td>
						<td colspan=2 class="tm">
							1:00-<br>1:50
						</td>
						<td class="slot-G slot-G1"><span class="slot-name">D1</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-A slot-A2"><span class="slot-name">A2</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-B slot-B3"><span class="slot-name">B3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-A slot-D4"><span class="slot-name">D4</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-B slot-C4"><span class="slot-name">C4</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
					</tr>

					<tr>
						<td class=structtd></td>
						<td class=tm>
							2:00-<br>3:15
						</td>

						<td class=tm rowspan=2>
							2:00-<br>4:45
						</td>
						<td class="slot-H slot-H1 slot-clash-P clashbuddy-M2"><span class="slot-name">H1 [P]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-P  slot-clash-H1 slot-clash-M2" style="display:none" rowspan=2><span class="slot-name">P [H1, M2]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>

						<td class="slot-M slot-M1 slot-clash-Q clashbuddy-H2"><span class="slot-name">M1 [Q]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-Q  slot-clash-M1 slot-clash-H2" style="display:none" rowspan=2><span class="slot-name">Q [M1, H2]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>

						<td class="slot-J slot-J1 slot-clash-R clashbuddy-K2"><span class="slot-name">J1 [R]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-R  slot-clash-J1 slot-clash-K2" style="display:none" rowspan=2><span class="slot-name">R [J1, K2]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>

						<td class="slot-L slot-L1 slot-clash-S clashbuddy-J2"><span class="slot-name">L1 [S]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-S  slot-clash-L1 slot-clash-J2" style="display:none" rowspan=2><span class="slot-name">S [L1, J2]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>

						<td class="slot-K slot-K1 slot-clash-T clashbuddy-L2"><span class="slot-name">K1 [T]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-T  slot-clash-K1 slot-clash-L2" style="display:none" rowspan=2><span class="slot-name">T [K1, L2]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
					</tr>
					<tr>
						<td class=structtd></td>
						<td class=tm>
							3:30-<br>4:45
						</td>
						
						<td class="slot-M slot-M2 slot-clash-P clashbuddy-H1"><span class="slot-name">M2 [P]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>

						<td class="slot-H slot-H2 slot-clash-Q clashbuddy-M1"><span class="slot-name">H2 [Q]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						
						<td class="slot-K slot-K2 slot-clash-R clashbuddy-J1"><span class="slot-name">K2 [R]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						
						<td class="slot-J slot-J2 slot-clash-S clashbuddy-L1"><span class="slot-name">J2 [S]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						
						<td class="slot-L slot-L2 slot-clash-T clashbuddy-K1"><span class="slot-name">L2 [T]</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>

					</tr>	

					<tr>
						<td class=structtd></td>
						<td colspan=2 class="tm">
							5:00-<br>5:50
						</td>
						<td class="slot-J slot-J3"><span class="slot-name">J3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-F slot-F1"><span class="slot-name">F1</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-G slot-G2"><span class="slot-name">G2</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-H slot-H3"><span class="slot-name">H3</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
						<td class="slot-E slot-E4"><span class="slot-name">E4</span><div class="slot-deets"><span class="course-name"></span><div class="course-venue"></div></div></td>
					</tr>
					
					
					
					</tbody>
				</table>
			</div>
			<div class="col-md-2 column side-bar">
				<button class="btn btn-default form-control"  style="z-index:2" onclick="printable()">Printable</button>
				<a style="z-index:2; margin-top:2px;margin-bottom:2px" class="btn form-control btn-default input-block-level" id=perma href>Permalink</a>
				<!-- <button class="btn btn-default form-control"  style="z-index:2" onclick = "validateICS()">Export as .ics</button> -->
				<form id = "icsForm" name = icsForm" target = "_blank" method = "POST" action = "download.php">
				</form>
				
				<table class="table table-striped table-hover">
					<thead>
						<tr>
							
							<th colspan=2>
								Course list
							</th>
						</tr>
					</thead>
					<tbody id="listb">
	
					
					
					</tbody>
				</table>
			</div>
		</div>
		</div>
		
	</div>
	<div class=row>

	
	</div>
</div>
<!-- <a href="https://github.com/krHariharan/IIT-Timetable"><img style="position: absolute; top: 0; right: 0; border: 0;" src="img/forkme_right_green_007200.png" alt="Fork me on GitHub"></a> -->
</body>

<!-- Site footer -->
<footer class="col-md-12 column">
	<div class="container">
		<div class="site-footer">
			<div class="row">
			<h4 style="text-align:center"><a href="https://krhariharan.github.io/">KR Hariharan</a></h4>
			<p style="text-align:center">Original design by <a href="https://github.com/Manishearth">Manish Goregaokar</a></p> 
			<p style="text-align:center">Repository for this website can be found <a href="https://github.com/krHariharan/IIT-Timetable">here</a> (forked from <a href="https://github.com/Manishearth/IIT-Timetable">here</a>)</p>
			<p style="text-align:center">Hope you find this resource useful :)</p>
			</div>
		</div>
	</div>		
</footer>
</html>
